---
phase: 06-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/architecture.md
  - docs/API.md
autonomous: true

must_haves:
  truths:
    - "User understands system architecture from docs/architecture.md"
    - "User can copy-paste curl commands from docs/API.md"
    - "User can diagnose errors using error code table"
  artifacts:
    - path: "docs/architecture.md"
      provides: "System design explanation with Mermaid diagrams"
      min_lines: 100
      contains: "```mermaid"
    - path: "docs/API.md"
      provides: "Complete endpoint reference with examples"
      min_lines: 150
      contains: "VALIDATION_FAILED"
  key_links:
    - from: "docs/API.md"
      to: "app/api/error_codes.py"
      via: "error code table"
      pattern: "17 error codes"
---

<objective>
Create the core reference documentation: architecture.md and API.md

Purpose: These documents provide the technical foundation that README will link to. API.md gives copy-paste examples for all endpoints. Architecture.md explains system design decisions.

Output: docs/architecture.md, docs/API.md
</objective>

<execution_context>
@/home/devuser/.claude/get-shit-done/workflows/execute-plan.md
@/home/devuser/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-documentation/06-CONTEXT.md

# Key source files to reference
@app/main.py
@app/api/jobs.py
@app/api/error_codes.py
@docker-compose.yml
@Dockerfile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/architecture.md with system design</name>
  <files>docs/architecture.md</files>
  <action>
Create docs/architecture.md following CONTEXT.md decisions:

**Structure:**
1. System Overview - high-level description of what the system does
2. Architecture Diagram - Mermaid flowchart showing: API -> Celery -> Redis -> Worker -> Models
3. Component Details:
   - FastAPI API layer (main.py, jobs.py)
   - Celery async queue (celery_app.py, tasks/)
   - Redis broker (DB 0 for Celery, DB 1 for app state)
   - Model workers (ReconViaGen via TRELLIS, nvdiffrec)
   - Services layer (file_handler, quality, preview)
4. Key Decisions - table format with Decision, Options Considered, Rationale columns:
   - Async queue over sync API (model inference takes minutes)
   - CUDA 12.1 + PyTorch 2.4.1 (spconv compatibility)
   - Celery + Redis (battle-tested, simple deployment)
   - Two-step cancellation (prevent accidental cancels)
   - Static previews over video (simpler, meets requirements)
5. Data Flow - Mermaid sequence diagram for job lifecycle
6. Deployment - production considerations: scaling, monitoring, resource requirements (16GB VRAM, 8GB shared memory)

**Mermaid diagrams must render on GitHub** - use standard flowchart and sequenceDiagram syntax.

Reference existing code for accuracy - don't invent features that don't exist.
  </action>
  <verify>
- File exists at docs/architecture.md
- Contains at least 2 Mermaid diagrams (```mermaid blocks)
- Contains Key Decisions table
- Contains Deployment section
- Mermaid syntax is valid (no parsing errors in preview)
  </verify>
  <done>
docs/architecture.md explains system design with diagrams, includes key decision rationale, and covers deployment considerations
  </done>
</task>

<task type="auto">
  <name>Task 2: Create docs/API.md with endpoint reference</name>
  <files>docs/API.md</files>
  <action>
Create docs/API.md following CONTEXT.md decisions:

**Structure:**
1. Overview - brief intro, base URL note (http://localhost:8000)
2. Authentication - note that demo has no auth (out of scope per PROJECT.md)
3. Endpoints - for each endpoint:
   - Method and path
   - Description
   - Request format (form data, query params, body)
   - Response format with full JSON example
   - Curl example (copy-paste ready)
   - Error responses

**Endpoints to document (from app/api/jobs.py):**
- GET /health - health check with GPU info
- POST /jobs - submit reconstruction job (multipart form: views[], depth_renders[], model_type)
- GET /jobs/{job_id} - get job status
- POST /jobs/{job_id}/cancel - two-step cancellation
- GET /jobs/{job_id}/download - download results ZIP

**Error Code Table:**
Create comprehensive table with all 17 error codes from app/api/error_codes.py:
| Code | HTTP Status | Meaning | Suggestion |

Error codes: VALIDATION_FAILED, FILE_TOO_LARGE, INVALID_FILE_FORMAT, INVALID_FILE_COUNT, JOB_NOT_FOUND, JOB_NOT_READY, JOB_EXPIRED, MODEL_FAILED, MODEL_OOM, MODEL_VRAM_OOM, MODEL_CONVERGENCE_FAILED, QUALITY_THRESHOLD_FAILED, INCOMPLETE_RESULTS, GPU_UNAVAILABLE, DISK_FULL, MEMORY_EXHAUSTED, UNKNOWN_ERROR

**Response Format Section:**
Document the structured error format:
```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable message",
    "details": {},
    "suggestion": "Actionable fix"
  }
}
```

Reference app/api/jobs.py and app/api/error_codes.py for accuracy.
  </action>
  <verify>
- File exists at docs/API.md
- Documents all 5 endpoints (health, submit, status, cancel, download)
- Contains curl examples for each endpoint
- Contains error table with all 17 error codes
- JSON examples are valid and complete
  </verify>
  <done>
docs/API.md provides complete endpoint reference with curl examples and comprehensive error documentation
  </done>
</task>

</tasks>

<verification>
```bash
# Check files exist
test -f docs/architecture.md && echo "architecture.md exists"
test -f docs/API.md && echo "API.md exists"

# Check architecture.md content
grep -c "mermaid" docs/architecture.md  # Should be >= 2
grep -q "Key Decisions" docs/architecture.md && echo "Has decisions section"
grep -q "Deployment" docs/architecture.md && echo "Has deployment section"

# Check API.md content
grep -c "curl" docs/API.md  # Should be >= 5 (one per endpoint)
grep -c "VALIDATION_FAILED\|FILE_TOO_LARGE\|JOB_NOT_FOUND" docs/API.md  # Error codes present
wc -l docs/API.md  # Should be 150+ lines
```
</verification>

<success_criteria>
- docs/architecture.md contains system overview, Mermaid diagrams, decision rationale, deployment guide
- docs/API.md documents all endpoints with curl examples and full error code table
- Both files are accurate to the actual implementation
</success_criteria>

<output>
After completion, create `.planning/phases/06-documentation/06-01-SUMMARY.md`
</output>
